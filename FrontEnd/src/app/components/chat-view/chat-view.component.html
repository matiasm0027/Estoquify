<div class="flex">
    <app-sidebar></app-sidebar>
    <div
        class="justify-center lg:mt-24 lg:ml-80 lg:mr-12 md:mt-24 md:ml-12 md:mr-12 sm:mt-24 sm:ml-12 sm:mr-12 mt-24 ml-12 mr-12 box-fl container">
        <div class="flex justify-between items-center mb-4">
            <div class="bg-white p-4 rounded-lg shadow-md w-full flex flex-col lg:flex-row items-start">
                <div class="w-full lg:w-2/3 flex flex-wrap">
                    <h4 class="text-md font-semibold mb-2 mt-2 w-full">Chats Activos</h4>
                    <div *ngFor="let chat of activeChats" class="bg-gray-100 p-2 rounded mb-2 lg:ml-2"
                        (click)="seleccionarChatActivo(chat)">
                        <p><strong>De:</strong> {{ chat.sender.name }} {{ chat.sender.last_name }}</p>
                        <p><strong>Para:</strong> {{ chat.receiver.name }} {{ chat.receiver.last_name }}</p>
                        <p><strong>Último mensaje:</strong> {{ obtenerUltimaLinea(chat.message) || 'Sin mensajes' }}</p>
                    </div>
                    <ng-container *ngIf="activeChats.length === 0">
                        <p>No hay chats activos.</p>
                    </ng-container>
                </div>
                <!-- Columna izquierda con el buscador y el botón de nueva conexión -->
                <div class="w-full lg:w-1/3 pr-4 mb-4 lg:mb-0">
                    <h3 class="text-lg font-bold mb-2 mt-2">Chat</h3>
                    <form [formGroup]="formularioEmpleado" class="flex justify-between items-center space-x-2">
                        <div class="w-full lg:w-auto">
                            <ng-select formControlName="fullname" [items]="filteredEmployees" bindLabel="fullname"
                                [placeholder]="placeholder" (search)="buscarEmpleado($event)"
                                (change)="seleccionarEmpleado($event)" (click)="limpiarSeleccion()"
                                class="ml-auto w-full lg:w-auto">
                            </ng-select>
                            <input type="text"
                                [value]="selectedEmployee ? selectedEmployee.name + ' ' + selectedEmployee.last_name : ''">
                        </div>
                        <button (click)="crearConexion()"
                            class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
                            Iniciar chat
                        </button>
                    </form>
                </div>
                
            </div>


            <div *ngIf="mostrarMensajes" class="fixed z-10 inset-0 overflow-y-auto">
                <div class="flex items-center justify-center min-h-screen px-4">
                  <div class="bg-white rounded-lg overflow-hidden shadow-xl w-full sm:max-w-lg relative h-4/5">
                    <div class="bg-white p-4 rounded-lg shadow-md w-full h-full">
                      <h3 class="text-lg font-bold mb-2">Mensajes</h3>
                      <!-- Área para mostrar los mensajes -->
                      <div class="h-96 overflow-y-auto mb-4">
                        <!-- Mostrar mensajes del chat activo -->
                        <div *ngIf="chatActivo">
                          <div *ngFor="let message of chatActivo.message.split('\n')" class="flex mb-1">
                            <div [ngClass]="{'ml-auto': message.startsWith('R:'), 'mr-auto': message.startsWith('S:')}">
                              <span>{{ message }}</span>
                            </div>
                          </div>
                        </div>
                      </div>
                      <!-- Campo de entrada para editar el mensaje -->
                      <div class="flex">
                        <input type="text" [(ngModel)]="nuevoMensaje" placeholder="Escribe tu mensaje aquí" class="w-full mt-2 p-2 border rounded" (keyup.enter)="enviarMensaje()">
                        <button class="ml-2 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600" (click)="enviarMensaje()">Enviar</button>
                    </div>
                    </div>
                    <!-- Botón para cerrar el modal -->
                    <button class="absolute top-0 right-0 m-4 text-gray-500 hover:text-gray-700 focus:outline-none" (click)="cerrarModal()">
                      <i class="fas fa-times"></i>
                    </button>
                  </div>
                </div>
              </div>
            
        </div>
    </div>
</div>